<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ---------------- Reset & Base ---------------- */
body, html { margin:0; padding:0; font-family: 'Roboto', sans-serif; background:#2C2F33; color:#FFF; }
a { text-decoration:none; color:inherit; cursor:pointer; }

/* ---------------- Sidebar ---------------- */
.sidebar {
    position: fixed; left:0; top:0; width:250px; height:100vh; background:#23272A; display:flex; flex-direction:column; padding-top:2rem; box-shadow:2px 0 5px rgba(0,0,0,0.3);
}
.sidebar h2 { text-align:center; margin-bottom:2rem; color:#7289DA; }
.sidebar a { padding:0.8rem 1.2rem; margin:0.2rem 0; display:flex; align-items:center; border-radius:6px; transition:0.2s; font-weight:500; }
.sidebar a:hover { background:#7289DA; color:white; transform:translateX(5px); }
.sidebar a i { margin-right:0.8rem; }

/* ---------------- Main ---------------- */
.main { margin-left:250px; padding:2rem; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; }
header h1 { font-weight:700; font-size:2rem; }
header .user { color:#B9BBBE; font-size:0.9rem; display:flex; align-items:center; gap:0.5rem; }

/* ---------------- Stats Cards ---------------- */
.stats { display:flex; gap:1rem; flex-wrap:wrap; margin-bottom:2rem; }
.stat-card { flex:1; min-width:150px; background:#36393F; padding:1.2rem; border-radius:10px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.3); transition:0.2s; cursor:pointer; }
.stat-card:hover { transform:translateY(-3px); box-shadow:0 6px 10px rgba(0,0,0,0.5); }
.stat-card h2 { margin:0; font-size:2rem; color:#43B581; }
.stat-card p { margin:0.2rem 0 0 0; color:#B9BBBE; font-size:0.95rem; }

/* ---------------- Tables ---------------- */
table { width:100%; border-collapse:collapse; background:#36393F; border-radius:10px; overflow:hidden; }
th, td { padding:0.8rem; border-bottom:1px solid #23272A; text-align:center; font-size:0.95rem; }
th { background:#2C2F33; color:#B9BBBE; text-transform:uppercase; letter-spacing:0.5px; }
tr:hover { background:#4F545C; }
input[type="number"], input[type="text"] { padding:0.35rem; border-radius:5px; border:none; width:90px; background:#202225; color:#FFF; }
button { padding:0.35rem 0.8rem; background:#7289DA; border:none; border-radius:5px; color:#FFF; cursor:pointer; font-weight:500; transition:0.2s; }
button:hover { background:#5b6eae; transform:translateY(-1px); }

/* ---------------- Sections ---------------- */
section { display:none; margin-top:1.5rem; animation:fadeIn 0.3s ease-in; }
section.active { display:block; }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

/* ---------------- Charts ---------------- */
canvas { background:#36393F; border-radius:10px; padding:1rem; }

/* ---------------- Responsive ---------------- */
@media(max-width:900px) {
    .sidebar { width:200px; }
    .main { margin-left:200px; padding:1rem; }
    .stats { flex-direction:column; }
}
</style>
</head>
<body>

<div class="sidebar">
    <h2>Dashboard</h2>
    <a onclick="showSection('membres')"><i>üë•</i>Membres</a>
    <a onclick="showSection('moderation')"><i>üõ°Ô∏è</i>Mod√©ration</a>
    <a onclick="showSection('configuration')"><i>‚öôÔ∏è</i>Configuration</a>
    <a onclick="showSection('statistiques')"><i>üìä</i>Statistiques</a>
    <a href="{{ url_for('logout') }}"><i>üö™</i>D√©connexion</a>
</div>

<div class="main">
    <header>
        <h1>Dashboard</h1>
        <div class="user">{{ user.username if user.username else "Inconnu" }}</div>
    </header>

    <!-- ---------------- Stats Globales ---------------- -->
    <div class="stats">
        <div class="stat-card"><h2>{{ total_balance }}</h2><p>Balance totale</p></div>
        <div class="stat-card"><h2>{{ prison_count }}</h2><p>En prison</p></div>
        <div class="stat-card"><h2>{{ marriages_count }}</h2><p>Mariages</p></div>
        <div class="stat-card"><h2>{{ 'Activ√©' if leveling.enabled else 'D√©sactiv√©' }}</h2><p>Leveling</p></div>
    </div>

    <!-- ---------------- Membres ---------------- -->
    <section id="membres" class="active">
        <h2>Membres</h2>
        <form method="GET" action="{{ url_for('dashboard') }}" style="margin-bottom:1rem;">
            <input type="text" name="search" placeholder="Rechercher ID ou username">
            <button type="submit">üîç Rechercher</button>
        </form>
        <table>
            <thead>
                <tr><th>Guild</th><th>User</th><th>XP</th><th>Level</th><th>Balance</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u["guild_id"] if u["guild_id"] else "N/A" }}</td>
                    <td>{{ u["username"] if u["username"] else u["user_id"] }}</td>
                    <td>{{ u["xp"] if u["xp"] else 0 }}</td>
                    <td>{{ u["level"] if u["level"] else 0 }}</td>
                    <td>{{ u["balance"] if u["balance"] else 0 }}</td>
                    <td>
                        <form action="{{ url_for('update_balance') }}" method="POST">
                            <input type="hidden" name="user_id" value="{{ u['user_id'] }}">
                            <input type="number" name="balance" placeholder="{{ u['balance'] }}">
                            <button type="submit">üí∞ Update</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- ---------------- Mod√©ration ---------------- -->
    <section id="moderation">
        <h2>Mod√©ration</h2>
        <p>Prison, Warn, Logs et R√¥les.</p>
    </section>

    <!-- ---------------- Configuration ---------------- -->
    <section id="configuration">
        <h2>Configuration</h2>
        <p>Commandes, Permissions et S√©curit√©.</p>
    </section>

    <!-- ---------------- Statistiques ---------------- -->
    <section id="statistiques">
        <h2>Statistiques</h2>
        <canvas id="statsChart" height="200"></canvas>
    </section>

    <!-- ---------------- Toggle Leveling ---------------- -->
    <form style="margin-top:1rem;" action="{{ url_for('toggle_leveling') }}" method="POST">
        <button type="submit">
            {% if leveling.enabled %} D√©sactiver Leveling {% else %} Activer Leveling {% endif %}
        </button>
    </form>

</div>

<script>
// ---------------- Onglets ----------------
function showSection(id){
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// ---------------- Chart Statistiques ----------------
const ctx = document.getElementById('statsChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [{% for u in users %}"{{ u.username if u.username else u.user_id }}",{% endfor %}],
        datasets: [{
            label: 'XP',
            data: [{% for u in users %}{{ u.xp if u.xp else 0 }},{% endfor %}],
            backgroundColor: '#43B581'
        },{
            label: 'Level',
            data: [{% for u in users %}{{ u.level if u.level else 0 }},{% endfor %}],
            backgroundColor: '#7289DA'
        }]
    },
    options: {
        responsive:true,
        plugins: { legend:{ labels:{ color:'#FFF' } } },
        scales: {
            x: { ticks:{ color:'#B9BBBE' } },
            y: { ticks:{ color:'#B9BBBE' } }
        }
    }
});
</script>

</body>
</html>
