<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Bot Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
if (localStorage.getItem("theme") === "dark") {
    document.documentElement.classList.add("dark");
}

function toggleTheme() {
    document.documentElement.classList.toggle("dark");
    localStorage.setItem(
        "theme",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
    );
}

function toggleCommand(id, button) {
    fetch("/toggle_command_ajax", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({command_id: id})
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            if (data.new_state === 1) {
                button.classList.remove("bg-green-600");
                button.classList.add("bg-red-600");
                button.innerText = "DÃ©sactiver";
            } else {
                button.classList.remove("bg-red-600");
                button.classList.add("bg-green-600");
                button.innerText = "Activer";
            }
        }
    });
}
</script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition">

<div class="flex min-h-screen">

<!-- Sidebar -->
<div class="w-64 bg-gradient-to-b from-purple-600 to-purple-800 text-white p-6">
<h2 class="text-2xl font-bold mb-8">âš¡ Premium Panel</h2>

<p class="mb-4">ðŸ‘¤ {{ user.username }}</p>

<button onclick="toggleTheme()" class="mb-6 bg-purple-900 px-3 py-2 rounded w-full">
ðŸŒ™ Dark Mode
</button>

<h3 class="mb-3 font-semibold">Serveurs</h3>

{% for guild in guilds %}
<a href="/?guild_id={{ guild.id }}"
class="block p-2 rounded hover:bg-purple-700
{% if selected_guild == guild.id %}bg-purple-900{% endif %}">
{{ guild.name }}
</a>
{% endfor %}

</div>

<!-- Content -->
<div class="flex-1 p-8">

<h1 class="text-3xl font-bold mb-8">Dashboard</h1>

{% if selected_guild %}

<!-- Graph -->
<div class="bg-white dark:bg-gray-800 p-6 rounded shadow mb-8">
<canvas id="statsChart"></canvas>
</div>

<script>
new Chart(document.getElementById('statsChart'), {
    type: 'bar',
    data: {
        labels: ['Commandes'],
        datasets: [{
            label: 'Total',
            data: [{{ commands|length }}],
            backgroundColor: 'rgba(139,92,246,0.7)'
        }]
    }
});
</script>

<!-- Commands -->
<div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
<h2 class="text-xl font-semibold mb-4">Commandes</h2>

{% for cmd in commands %}
<div class="flex justify-between items-center border-b py-3">
<span>{{ cmd.name }}</span>
<button onclick="toggleCommand({{ cmd.id }}, this)"
class="px-4 py-1 rounded text-white
{% if cmd.enabled %}
bg-red-600
{% else %}
bg-green-600
{% endif %}">
{% if cmd.enabled %}DÃ©sactiver{% else %}Activer{% endif %}
</button>
</div>
{% endfor %}

</div>

{% else %}
SÃ©lectionne un serveur ðŸ‘ˆ
{% endif %}

</div>
</div>

</body>
</html>
