<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body.dark-mode {
            background-color: #1f1f2e;
            color: #f0f0f0;
        }
        .table-dark-mode {
            background-color: #2b2b3a;
            color: #f0f0f0;
        }
        .toggle-btn {
            cursor: pointer;
        }
        .container {
            margin-top: 30px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Dashboard Bot</h2>
        <div>
            <button id="modeToggle" class="btn btn-secondary">Mode Sombre</button>
            <a href="/logout" class="btn btn-danger">Déconnexion</a>
        </div>
    </div>

    <!-- Sélection du serveur -->
    <form method="get" class="mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label for="guildSelect" class="col-form-label">Serveur:</label>
            </div>
            <div class="col-auto">
                <select name="guild_id" id="guildSelect" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Tous les serveurs --</option>
                    {% for guild in guilds %}
                        <option value="{{ guild.id }}" {% if selected_guild == guild.id %}selected{% endif %}>
                            {{ guild.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <input type="text" name="search_user" class="form-control" placeholder="Rechercher membre" value="{{ search_user or '' }}">
            </div>
            <div class="col-auto">
                <input type="text" name="search_cmd" class="form-control" placeholder="Rechercher commande" value="{{ search_cmd or '' }}">
            </div>
            <div class="col-auto">
                <button class="btn btn-primary" type="submit">Filtrer</button>
            </div>
        </div>
    </form>

    <!-- Statistiques -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-bg-info mb-3">
                <div class="card-body">
                    <h5 class="card-title">Solde total</h5>
                    <p class="card-text">{{ total_balance }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-warning mb-3">
                <div class="card-body">
                    <h5 class="card-title">En prison</h5>
                    <p class="card-text">{{ prison_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Mariages</h5>
                    <p class="card-text">{{ marriages_count }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Utilisateurs -->
    <h4>Utilisateurs</h4>
    <table class="table table-striped table-hover {% if 'dark-mode' in body_class %}table-dark-mode{% endif %}">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>XP</th>
                <th>Niveau</th>
                <th>Balance</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.user_id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.xp }}</td>
                <td>{{ user.level }}</td>
                <td>{{ user.balance }}</td>
                <td>
                    <form method="post" action="/update_balance" class="d-inline">
                        <input type="hidden" name="user_id" value="{{ user.user_id }}">
                        <input type="number" name="balance" class="form-control form-control-sm d-inline w-auto" placeholder="Nouveau solde">
                        <button class="btn btn-sm btn-primary" type="submit">Modifier</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Commandes -->
    <h4>Commandes</h4>
    <table class="table table-striped table-hover {% if 'dark-mode' in body_class %}table-dark-mode{% endif %}">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Catégorie</th>
                <th>Description</th>
                <th>Activée</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for cmd in commands %}
            <tr>
                <td>{{ cmd.id }}</td>
                <td>{{ cmd.name }}</td>
                <td>{{ cmd.category }}</td>
                <td>{{ cmd.description }}</td>
                <td>{{ 'Oui' if cmd.enabled else 'Non' }}</td>
                <td>
                    <form method="post" action="/toggle_command">
                        <input type="hidden" name="command_id" value="{{ cmd.id }}">
                        <button class="btn btn-sm btn-warning toggle-btn" type="submit">
                            {% if cmd.enabled %}Désactiver{% else %}Activer{% endif %}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const toggleBtn = document.getElementById('modeToggle');
    toggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        toggleBtn.textContent = document.body.classList.contains('dark-mode') ? 'Mode Clair' : 'Mode Sombre';
    });
</script>
</body>
</html>
